# STAN Volume
OECD STAN  
2015-08-10  
<!-- # rmarkdown::render(file.path(dbpath, "GitHub", "stan", "vignettes", "stan_volume.Rmd")) -->

```
## Loading required package: zoo
## 
## Attaching package: 'zoo'
## 
## The following objects are masked from 'package:base':
## 
##     as.Date, as.Date.numeric
## 
## 
## Attaching package: 'xts'
## 
## The following objects are masked from 'package:dplyr':
## 
##     first, last
```


## General

- situation: only current prices `VALU` and chained index `VKOT` series in data
- objective: calculate previous year price `VALPY` series
- intermediate step: calculate chained volume `VALK` series

### Laspeyres chained

- data source: SWE Eurostat, Total Economy Value-added (at basic prices)

<!--html_preserve--><div id="htmlwidget-1851" style="width:672px;height:480px;" class="dygraphs"></div>
<script type="application/json" data-for="htmlwidget-1851">{"x":{"attrs":{"title":"All Data","ylabel":"Billion USD","labels":["year","EUNAMA10R2_VALU","EUNAMA10R2_VKPY","NSONA_VALU","STANi4_VALU","STANi4_VKPY","NSONA_VKOT"],"legend":"auto","retainDateWindow":false,"axes":{"x":{"pixelsPerLabel":50}},"series":{"NSONA_VKOT":{"axis":"y2"}}},"scale":"yearly","annotations":[],"shadings":[],"events":[],"data":[["1970-01-01T00:00:00Z","1971-01-01T00:00:00Z","1972-01-01T00:00:00Z","1973-01-01T00:00:00Z","1974-01-01T00:00:00Z","1975-01-01T00:00:00Z","1976-01-01T00:00:00Z","1977-01-01T00:00:00Z","1978-01-01T00:00:00Z","1979-01-01T00:00:00Z","1980-01-01T00:00:00Z","1981-01-01T00:00:00Z","1982-01-01T00:00:00Z","1983-01-01T00:00:00Z","1984-01-01T00:00:00Z","1985-01-01T00:00:00Z","1986-01-01T00:00:00Z","1987-01-01T00:00:00Z","1988-01-01T00:00:00Z","1989-01-01T00:00:00Z","1990-01-01T00:00:00Z","1991-01-01T00:00:00Z","1992-01-01T00:00:00Z","1993-01-01T00:00:00Z","1994-01-01T00:00:00Z","1995-01-01T00:00:00Z","1996-01-01T00:00:00Z","1997-01-01T00:00:00Z","1998-01-01T00:00:00Z","1999-01-01T00:00:00Z","2000-01-01T00:00:00Z","2001-01-01T00:00:00Z","2002-01-01T00:00:00Z","2003-01-01T00:00:00Z","2004-01-01T00:00:00Z","2005-01-01T00:00:00Z","2006-01-01T00:00:00Z","2007-01-01T00:00:00Z","2008-01-01T00:00:00Z","2009-01-01T00:00:00Z","2010-01-01T00:00:00Z","2011-01-01T00:00:00Z","2012-01-01T00:00:00Z","2013-01-01T00:00:00Z"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,34182373830.2067,40278409584.2778,52579264156.8462,55745968105.218,52205962689.0701,53448685071.4862,53614867461.2811,52768076380.1227,46379194516.3532,49595756720.7564,60819131937.592,69677901323.8287,70343073245.2648,76202902246.7955,88355721529.2131,86555669331.3293,65312360942.2441,79813676194.1717,90636493788.9586,82554493415.083,84367422537.6581],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,39977086484.2657,49532834528.165,57842760918.8699,53227456874.8114,54516501521.021,55521086718.4527,53012121393.4759,46403785150.468,51433876603.5281,62390307067.5571,73049704581.1021,71160941270.8223,77053375015.9111,86641800209.2096,87957711656.3385,59908130831.8515,85172520522.2459,92950638660.0434,80569553404.4877,85162175764.2482],[null,null,null,null,null,null,null,null,null,null,27650768700.7916,24126870233.0188,21298956249.0046,19979370756.2472,21767329965.9926,22925350930.8417,29932407613.2096,36085183340.2773,40200582652.6199,41003426595.1298,45950777101.4007,44271926536.7316,44287668488.6815,34182373830.2068,40278409584.2778,52579264156.8462,55745968105.218,52205962689.0701,53448685071.4862,53614867461.2811,52768076380.1227,46379194516.3531,49595756720.7564,60819131937.592,69677901323.8287,70343073245.2648,76202902246.7955,88355721529.2131,86555669331.3293,65312360942.2441,79813676194.1716,90636493788.9586,82554493415.083,null],[7745715262.22123,8186188731.14042,9315132174.76738,11633853784.3343,14561020585.9004,17777129522.5478,17893448452.4355,17280349101.3777,18123918119.747,21938344751.9343,24509965959.3482,21368678401.2262,19170157649.358,18006658963.691,19292488491.8946,20158944979.2647,27063835399.3661,32656627229.8592,36329012063.8469,37283190619.7459,41846813531.8198,39632293379.8174,39283538520.5048,31277483610.4749,36757659762.8037,47887305515.167,50289177021.3716,46371042253.0416,47267702070.2796,47635995632.4381,46244892876.9544,40014383261.9751,43594086823.0419,53557347222.3869,61387802052.5559,62637423662.194,67013188201.04,77318802089.7295,73025756073.3104,54606071935.9822,68563765944.1308,77192832059.3328,null,null],[null,7858516741.71581,8872999673.16135,10866646098.1343,12040228561.7589,15622382016.3784,17044421275.2407,16439411785.9032,16683973547.9957,20340741608.9653,22354443671.0337,19866264046.3989,17266247702.4989,16709460933.4565,17998622413.0234,18860439555.5216,24610194839.5681,31165804986.2206,34805471712.7274,34864149618.1759,40321988498.61,38642554415.6193,39550832779.5112,29934138954.1308,36565132070.5874,45044914478.237,52646192946.5542,47751878753.2472,48541864079.9682,49721589557.274,46742791628.296,40335132551.6992,45609974311.1713,55175986584.598,64797379676.1556,63544784738.5296,67946979517.1596,75955853198.6496,75007707350.2897,49615578958.9821,73916365125.1682,81160838440.87,null,null],[null,null,null,null,null,null,null,null,null,null,null,34.3,34.2,36.2,39.6,40.8,41.1,42,43.3,43.4,42.7,41,39.4,39.6,45.9,52.2,53.9,58.6,63.8,68.8,75.5,74.8,78.2,81.7,89.2,92.7,100.2,104.4,101.3,81.4,100,104.9,97.3,null]]},"evals":[]}</script><!--/html_preserve-->

### Fisher chained, (geometric average, combination of Paasche and Laspeyres)

- data source: USA BEA, Total Economy Value-added (at market prices incl. VAT)




```r
data_xts <- df2xts(data_df = data_csv_init)
dygraph(data = data_xts, main = "Initial Data", ylab = "Billion USD") %>%
  dySeries("VKOT", axis = 'y2')
```

<!--html_preserve--><div id="htmlwidget-4510" style="width:672px;height:432px;" class="dygraphs"></div>
<script type="application/json" data-for="htmlwidget-4510">{"x":{"attrs":{"title":"Initial Data","ylabel":"Billion USD","labels":["year","VALU","VKOT"],"legend":"auto","retainDateWindow":false,"axes":{"x":{"pixelsPerLabel":50}},"series":{"VKOT":{"axis":"y2"}}},"scale":"yearly","annotations":[],"shadings":[],"events":[],"data":[["1971-01-01T00:00:00Z","1972-01-01T00:00:00Z","1973-01-01T00:00:00Z","1974-01-01T00:00:00Z","1975-01-01T00:00:00Z","1976-01-01T00:00:00Z","1977-01-01T00:00:00Z","1978-01-01T00:00:00Z","1979-01-01T00:00:00Z","1980-01-01T00:00:00Z","1981-01-01T00:00:00Z","1982-01-01T00:00:00Z","1983-01-01T00:00:00Z","1984-01-01T00:00:00Z","1985-01-01T00:00:00Z","1986-01-01T00:00:00Z","1987-01-01T00:00:00Z","1988-01-01T00:00:00Z","1989-01-01T00:00:00Z","1990-01-01T00:00:00Z","1991-01-01T00:00:00Z","1992-01-01T00:00:00Z","1993-01-01T00:00:00Z","1994-01-01T00:00:00Z","1995-01-01T00:00:00Z","1996-01-01T00:00:00Z","1997-01-01T00:00:00Z","1998-01-01T00:00:00Z","1999-01-01T00:00:00Z","2000-01-01T00:00:00Z","2001-01-01T00:00:00Z","2002-01-01T00:00:00Z","2003-01-01T00:00:00Z","2004-01-01T00:00:00Z","2005-01-01T00:00:00Z","2006-01-01T00:00:00Z","2007-01-01T00:00:00Z","2008-01-01T00:00:00Z","2009-01-01T00:00:00Z","2010-01-01T00:00:00Z","2011-01-01T00:00:00Z"],[1126.817,1237.885,1382.269,1499.452,1637.7,1824.583,2030.13,2293.762,2562.228,2788.143,3126.837,3253.194,3534.606,3930.895,4217.47,4460.067,4736.354,5100.422,5482.146,5800.527,5992.094,6342.306,6667.35,7085.16,7414.655,7838.456,8332.362,8793.495,9353.484,9951.482,10286.167,10642.316,11142.212,11853.254,12622.959,13377.215,14028.675,14291.543,13973.681,14498.922,15075.667],[0.34932,0.36788,0.3892,0.38705,0.38623,0.40695,0.42566,0.4494,0.46345,0.46217,0.4739,0.4647,0.4857,0.5206,0.54214,0.56092,0.57887,0.60266,0.6242,0.63591,0.63442,0.65595,0.67466,0.70214,0.7198,0.74672,0.78,0.81397,0.85326,0.88857,0.89816,0.91445,0.93769,0.97021,1,1.02658,1.04622,1.0427,1.01069,1.03486,1.05356]]},"evals":[]}</script><!--/html_preserve-->


```r
data_csv_valk <- data_csv_init
data_csv_valk$VALK <- stan::cpIdxClGeom(data = data_csv_valk,
                                        var.cp = "VALU",
                                        var.idx = "VKOT",
                                        id.vars = "ind",
                                        refyear = 2005)
data_xts <- df2xts(data_df = data_csv_valk)
dygraph(data = data_xts, main = "Intermediate Data (including VALK)", ylab = "Billion USD") %>%
  dySeries("VKOT", axis = 'y2')
```

<!--html_preserve--><div id="htmlwidget-1242" style="width:672px;height:432px;" class="dygraphs"></div>
<script type="application/json" data-for="htmlwidget-1242">{"x":{"attrs":{"title":"Intermediate Data (including VALK)","ylabel":"Billion USD","labels":["year","VALU","VALK","VKOT"],"legend":"auto","retainDateWindow":false,"axes":{"x":{"pixelsPerLabel":50}},"series":{"VKOT":{"axis":"y2"}}},"scale":"yearly","annotations":[],"shadings":[],"events":[],"data":[["1971-01-01T00:00:00Z","1972-01-01T00:00:00Z","1973-01-01T00:00:00Z","1974-01-01T00:00:00Z","1975-01-01T00:00:00Z","1976-01-01T00:00:00Z","1977-01-01T00:00:00Z","1978-01-01T00:00:00Z","1979-01-01T00:00:00Z","1980-01-01T00:00:00Z","1981-01-01T00:00:00Z","1982-01-01T00:00:00Z","1983-01-01T00:00:00Z","1984-01-01T00:00:00Z","1985-01-01T00:00:00Z","1986-01-01T00:00:00Z","1987-01-01T00:00:00Z","1988-01-01T00:00:00Z","1989-01-01T00:00:00Z","1990-01-01T00:00:00Z","1991-01-01T00:00:00Z","1992-01-01T00:00:00Z","1993-01-01T00:00:00Z","1994-01-01T00:00:00Z","1995-01-01T00:00:00Z","1996-01-01T00:00:00Z","1997-01-01T00:00:00Z","1998-01-01T00:00:00Z","1999-01-01T00:00:00Z","2000-01-01T00:00:00Z","2001-01-01T00:00:00Z","2002-01-01T00:00:00Z","2003-01-01T00:00:00Z","2004-01-01T00:00:00Z","2005-01-01T00:00:00Z","2006-01-01T00:00:00Z","2007-01-01T00:00:00Z","2008-01-01T00:00:00Z","2009-01-01T00:00:00Z","2010-01-01T00:00:00Z","2011-01-01T00:00:00Z"],[1126.817,1237.885,1382.269,1499.452,1637.7,1824.583,2030.13,2293.762,2562.228,2788.143,3126.837,3253.194,3534.606,3930.895,4217.47,4460.067,4736.354,5100.422,5482.146,5800.527,5992.094,6342.306,6667.35,7085.16,7414.655,7838.456,8332.362,8793.495,9353.484,9951.482,10286.167,10642.316,11142.212,11853.254,12622.959,13377.215,14028.675,14291.543,13973.681,14498.922,15075.667],[4409.45203788,4643.73415692,4912.8556428,4885.71628095,4875.36545457,5136.91316505,5373.08872794,5672.7577746,5850.11034855,5833.95296103,5982.0202701,5865.8890473,6130.9711863,6571.5124554,6843.41099226,7080.47016228,7307.05227633,7607.35247094,7879.2510078,8027.06585769,8008.25764878001,8280.02995605001,8516.20551894001,8863.08443226001,9086.00588820001,9425.81594448001,9845.90802000001,10274.70993723,10770.66599634,11216.38267863,11337.43685544,11543.06485755,11836.42242471,12246.92105139,12622.959,12958.47725022,13206.39216498,13161.9593493,12757.89843171,13062.99535074,13299.04468404],[0.34932,0.36788,0.3892,0.38705,0.38623,0.40695,0.42566,0.4494,0.46345,0.46217,0.4739,0.4647,0.4857,0.5206,0.54214,0.56092,0.57887,0.60266,0.6242,0.63591,0.63442,0.65595,0.67466,0.70214,0.7198,0.74672,0.78,0.81397,0.85326,0.88857,0.89816,0.91445,0.93769,0.97021,1,1.02658,1.04622,1.0427,1.01069,1.03486,1.05356]]},"evals":[]}</script><!--/html_preserve-->


```r
data_csv_vkpy <- data_csv_valk
data_csv_vkpy$VKPY <- stan::cpVolPyp(data = data_csv_valk,
                                     var.cp = "VALU",
                                     var.cl = "VALK",
                                     id.vars = "ind")
data_xts <- df2xts(data_df = data_csv_vkpy)
dygraph(data = data_xts, main = "Final Data (including VKPY)", ylab = "Billion USD") %>%
  dySeries("VKOT", axis = 'y2')
```

<!--html_preserve--><div id="htmlwidget-3864" style="width:672px;height:432px;" class="dygraphs"></div>
<script type="application/json" data-for="htmlwidget-3864">{"x":{"attrs":{"title":"Final Data (including VKPY)","ylabel":"Billion USD","labels":["year","VALU","VALK","VKPY","VKOT"],"legend":"auto","retainDateWindow":false,"axes":{"x":{"pixelsPerLabel":50}},"series":{"VKOT":{"axis":"y2"}}},"scale":"yearly","annotations":[],"shadings":[],"events":[],"data":[["1971-01-01T00:00:00Z","1972-01-01T00:00:00Z","1973-01-01T00:00:00Z","1974-01-01T00:00:00Z","1975-01-01T00:00:00Z","1976-01-01T00:00:00Z","1977-01-01T00:00:00Z","1978-01-01T00:00:00Z","1979-01-01T00:00:00Z","1980-01-01T00:00:00Z","1981-01-01T00:00:00Z","1982-01-01T00:00:00Z","1983-01-01T00:00:00Z","1984-01-01T00:00:00Z","1985-01-01T00:00:00Z","1986-01-01T00:00:00Z","1987-01-01T00:00:00Z","1988-01-01T00:00:00Z","1989-01-01T00:00:00Z","1990-01-01T00:00:00Z","1991-01-01T00:00:00Z","1992-01-01T00:00:00Z","1993-01-01T00:00:00Z","1994-01-01T00:00:00Z","1995-01-01T00:00:00Z","1996-01-01T00:00:00Z","1997-01-01T00:00:00Z","1998-01-01T00:00:00Z","1999-01-01T00:00:00Z","2000-01-01T00:00:00Z","2001-01-01T00:00:00Z","2002-01-01T00:00:00Z","2003-01-01T00:00:00Z","2004-01-01T00:00:00Z","2005-01-01T00:00:00Z","2006-01-01T00:00:00Z","2007-01-01T00:00:00Z","2008-01-01T00:00:00Z","2009-01-01T00:00:00Z","2010-01-01T00:00:00Z","2011-01-01T00:00:00Z"],[1126.817,1237.885,1382.269,1499.452,1637.7,1824.583,2030.13,2293.762,2562.228,2788.143,3126.837,3253.194,3534.606,3930.895,4217.47,4460.067,4736.354,5100.422,5482.146,5800.527,5992.094,6342.306,6667.35,7085.16,7414.655,7838.456,8332.362,8793.495,9353.484,9951.482,10286.167,10642.316,11142.212,11853.254,12622.959,13377.215,14028.675,14291.543,13973.681,14498.922,15075.667],[4409.45203788,4643.73415692,4912.8556428,4885.71628095,4875.36545457,5136.91316505,5373.08872794,5672.7577746,5850.11034855,5833.95296103,5982.0202701,5865.8890473,6130.9711863,6571.5124554,6843.41099226,7080.47016228,7307.05227633,7607.35247094,7879.2510078,8027.06585769,8008.25764878001,8280.02995605001,8516.20551894001,8863.08443226001,9086.00588820001,9425.81594448001,9845.90802000001,10274.70993723,10770.66599634,11216.38267863,11337.43685544,11543.06485755,11836.42242471,12246.92105139,12622.959,12958.47725022,13206.39216498,13161.9593493,12757.89843171,13062.99535074,13299.04468404],[null,1186.68681426772,1309.62499184517,1374.63313579137,1496.27527699264,1725.55734924786,1908.47032750952,2143.35484189259,2365.47396283934,2555.15139661236,2858.9068258433,3066.13453028065,3400.20728599096,3788.58530697962,4093.53710199769,4363.56526432287,4602.79359675177,4931.00540991933,5282.71896658149,5584.9911292214,5786.93579176299,6195.44475158412,6523.21086357192,6938.92201849821,7263.36367106275,7691.95774048347,8187.80222841225,8695.24704761538,9217.95341806209,9740.55420139231,10058.8845821038,10472.7280363744,10912.7817705069,11528.6347348484,12217.2045227322,12958.47725022,13633.1409897913,13981.4756193726,13852.8048284933,14307.8525756266,14760.9186385791],[0.34932,0.36788,0.3892,0.38705,0.38623,0.40695,0.42566,0.4494,0.46345,0.46217,0.4739,0.4647,0.4857,0.5206,0.54214,0.56092,0.57887,0.60266,0.6242,0.63591,0.63442,0.65595,0.67466,0.70214,0.7198,0.74672,0.78,0.81397,0.85326,0.88857,0.89816,0.91445,0.93769,0.97021,1,1.02658,1.04622,1.0427,1.01069,1.03486,1.05356]]},"evals":[]}</script><!--/html_preserve-->


```r
data_xts <- df2xts(data_df = subset(data_csv, select = names(data_csv_vkpy)))
dygraph(data = data_xts, main = "Original Data (for comparison)", ylab = "Billion USD") %>%
  dySeries("VKOT", axis = 'y2')
```

<!--html_preserve--><div id="htmlwidget-8542" style="width:672px;height:432px;" class="dygraphs"></div>
<script type="application/json" data-for="htmlwidget-8542">{"x":{"attrs":{"title":"Original Data (for comparison)","ylabel":"Billion USD","labels":["year","VALU","VALK","VKPY","VKOT"],"legend":"auto","retainDateWindow":false,"axes":{"x":{"pixelsPerLabel":50}},"series":{"VKOT":{"axis":"y2"}}},"scale":"yearly","annotations":[],"shadings":[],"events":[],"data":[["1971-01-01T00:00:00Z","1972-01-01T00:00:00Z","1973-01-01T00:00:00Z","1974-01-01T00:00:00Z","1975-01-01T00:00:00Z","1976-01-01T00:00:00Z","1977-01-01T00:00:00Z","1978-01-01T00:00:00Z","1979-01-01T00:00:00Z","1980-01-01T00:00:00Z","1981-01-01T00:00:00Z","1982-01-01T00:00:00Z","1983-01-01T00:00:00Z","1984-01-01T00:00:00Z","1985-01-01T00:00:00Z","1986-01-01T00:00:00Z","1987-01-01T00:00:00Z","1988-01-01T00:00:00Z","1989-01-01T00:00:00Z","1990-01-01T00:00:00Z","1991-01-01T00:00:00Z","1992-01-01T00:00:00Z","1993-01-01T00:00:00Z","1994-01-01T00:00:00Z","1995-01-01T00:00:00Z","1996-01-01T00:00:00Z","1997-01-01T00:00:00Z","1998-01-01T00:00:00Z","1999-01-01T00:00:00Z","2000-01-01T00:00:00Z","2001-01-01T00:00:00Z","2002-01-01T00:00:00Z","2003-01-01T00:00:00Z","2004-01-01T00:00:00Z","2005-01-01T00:00:00Z","2006-01-01T00:00:00Z","2007-01-01T00:00:00Z","2008-01-01T00:00:00Z","2009-01-01T00:00:00Z","2010-01-01T00:00:00Z","2011-01-01T00:00:00Z"],[1126.817,1237.885,1382.269,1499.452,1637.7,1824.583,2030.13,2293.762,2562.228,2788.143,3126.837,3253.194,3534.606,3930.895,4217.47,4460.067,4736.354,5100.422,5482.146,5800.527,5992.094,6342.306,6667.35,7085.16,7414.655,7838.456,8332.362,8793.495,9353.484,9951.482,10286.167,10642.316,11142.212,11853.254,12622.959,13377.215,14028.675,14291.543,13973.681,14498.922,15075.667],[null,null,null,null,null,null,5373.0887,5672.7578,5850.1103,5833.953,5982.0203,5865.889,6130.9712,6571.5125,6843.411,7080.4702,7307.0523,7607.3525,7879.251,8027.0659,8008.2576,8280.03,8516.2055,8863.0844,9086.0059,9425.8159,9845.908,10274.71,10770.666,11216.383,11337.437,11543.065,11836.422,12246.921,12622.959,12958.477,13206.392,13161.959,12757.898,13062.995,13299.045],[null,null,null,null,null,null,null,2143.3548,2365.474,2555.1514,2858.9068,3066.1345,3400.2073,3788.5853,4093.5371,4363.5653,4602.7936,4931.0054,5282.719,5584.9911,5786.9358,6195.4448,6523.2109,6938.922,7263.3637,7691.9577,8187.8022,8695.247,9217.9534,9740.5542,10058.885,10472.728,10912.782,11528.635,12217.205,12958.477,13633.141,13981.476,13852.805,14307.853,14760.919],[0.34932,0.36788,0.3892,0.38705,0.38623,0.40695,0.42566,0.4494,0.46345,0.46217,0.4739,0.4647,0.4857,0.5206,0.54214,0.56092,0.57887,0.60266,0.6242,0.63591,0.63442,0.65595,0.67466,0.70214,0.7198,0.74672,0.78,0.81397,0.85326,0.88857,0.89816,0.91445,0.93769,0.97021,1,1.02658,1.04622,1.0427,1.01069,1.03486,1.05356]]},"evals":[]}</script><!--/html_preserve-->
